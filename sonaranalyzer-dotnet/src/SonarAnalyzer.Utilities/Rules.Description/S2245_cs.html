<p>使用伪随机数生成器是安全敏感的（security-sensitive）。举例来说，该行为已经导致了以下漏洞的产生（PRNGs）：</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>在需要不可预测性的时候，如果软件生成的值是可预测的，那么攻击者就很可能猜到下一个即将生成的值，并会用他的猜测值去假冒另一个用户或访问敏感的信息。</p>
<p>由于 <code>System.Random</code> 类依赖的是伪随机数生成器，因此不应将其用在安全性要求很高的应用里，也不能用于保护敏感数据。这种情况下应使用 <code>System.Cryptography.RandomNumberGenerator</code> 类。该类依赖的随机数生成器（RNG）是经过加密并具有强随机性的。</p>
<h2>需要考虑的问题</h2>
<ul>
  <li> 使用这个生成的数值的代码是否需要它无法被预测。因为所有的加密体制或是求某个机密数值（如口令）的hash值，都需要无法预测的生成数。</li>
  <li> 用来生成的函数是否能被预测（即是否是伪随机）。 </li>
  <li> 生成值是否要使用多次。 </li>
  <li> 攻击者是否能访问这个生成值。 </li>
</ul>
<p>如果你对第一个问题和其他任何问题的回答都是“是”，则安全风险是存在的。</p>
<h2>推荐的安全编码习惯</h2>
<ul>
  <li> 只使用 <a href="https://www.owasp.org/index.php/Cryptographic_Storage_Cheat_Sheet#Rule_-_Use_strong_random_numbers">OWASP建议的</a>或其他可信的安全机构推荐的随机数生成器。 </li>
  <li> 生成的随机数只用一次。 </li>
  <li> 不应泄露生成的随机数。如果你不得不存储这个值，要确保数据库或文件是安全的。 </li>
</ul>
<h2>可疑的代码示例</h2>
<pre>
var random = new Random(); // 此处对Random的使用可能有问题
byte[] data = new byte[16];
random.NextBytes(data);
return BitConverter.ToString(data); // 检查该值是否用于加密和生成hash值
</pre>
<h2>合规的解决方案</h2>
<pre>
using System.Security.Cryptography;
...
var randomGenerator = RandomNumberGenerator.Create(); // 符合安全敏感的需求
byte[] data = new byte[16];
randomGenerator.GetBytes(data);
return BitConverter.ToString(data);
</pre>
<h2>请参阅</h2>
<ul>
  <li> <a href="http://cwe.mitre.org/data/definitions/338.html">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG) </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/330.html">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/326.html">MITRE, CWE-326</a> - Inadequate Encryption Strength </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/310">MITRE, CWE-310</a> - Cryptographic Issues </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/mAFqAQ">CERT, MSC02-J.</a> - Generate strong random numbers </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/qw4">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/WYIyAQ">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li>
  <li> OWASP Top 10 2017 Category A3 - Sensitive Data Exposure </li>
  <li> Derived from FindSecBugs rule <a href="http://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number Generator</a> </li>
</ul>

