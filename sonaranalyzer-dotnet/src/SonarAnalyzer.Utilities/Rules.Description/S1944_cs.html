<p>不恰当的强制转换会导致意外的行为或是运行时的错误，例如 <code>InvalidCastException</code>。编译器会捕获类之间的这种不恰当转换，但捕获不到由类转换为接口的。还捕获不到已知为空但被强制转换为它们基础值类型的可空值。</p>
<p>这时用运算符 <code>as</code> 更好，因为它会返回 <code>null</code> 而不会引发异常。</p>
<h2>不合规的代码示例</h2>
<pre>
public interface IMyInterface
{ /* …… */ }

public class Implementer : IMyInterface
{ /* …… */ }

public class MyClass
{ /* …… */ }

public static class Program
{
  public static void Main()
  {
    var myclass = new MyClass();
    var x = (IMyInterface) myclass; // 不合规，会抛出 InvalidCastException 
    var b = myclass is IMyInterface; // 不合规，总为假 false

    int? i = null;
    var ii = (int)i; // 不合规，会抛出 InvalidOperationException
  }
}
</pre>
<h2>合规的解决方案</h2>
<pre>
public interface IMyInterface
{ /* …… */ }

public class Implementer : IMyInterface
{ /* …… */ }

public class MyClass
{ /* …… */ }

public static class Program
{
  public static void Main()
  {
    var myclass = new MyClass();
    var x = myclass as IMyInterface; // 合规，但总为 null
    var b = false;

    int? i = null;
    if (i.HasValue)
    {
      var ii = (int)i;
    }
  }
}
</pre>
<h2>例外</h2>
<p>如果接口在程序集中没有实现类，则不会报告任何问题。</p>
<h2>请参阅</h2>
<ul>
  <li> MISRA C:2004, 11.4 - A cast should not be performed between a pointer to object type and an integral type. </li>
  <li> MISRA C++:2008, 5-2-3 - Casts to a base class from a derived class should not be performed on polymorphic types. </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/tgAV">CERT, EXP36-C.</a> - Do not cast pointers into more strictly aligned pointer
  types </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/588.html">MITRE, CWE-588</a> - Attempt to Access Child of a Non-structure Pointer </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/704.html">MITRE, CWE-704</a> - Incorrect Type Conversion or Cast </li>
</ul>

