<p>使用相等 <code>==</code> 和不等运算符 <code>!=</code> 来比较两个对象通常是可行的。这两个运算符可以被重载，因此比较操作可解析为适当的方法。然而，当运算符用于比较接口的实例时，<code>==</code> 会解析为引用的相等（reference equality），如果实现的类重写了<code>Equals</code> ，则此次比较可能会产生意外的结果。同样，当某个类重写了 <code>Equals</code>，但它的实例却与未重写的 <code>==</code>进行比较时，很有可能是想进行值的比较而不是引用的比较。</p>
<h2>不合规的代码示例</h2>
<pre>
public interface IMyInterface
{
}

public class MyClass : IMyInterface
{
    public override bool Equals(object obj)
    {
        //……
    }
}

public class Program
{
    public static void Method(IMyInterface instance1, IMyInterface instance2)
    {
        if (instance1 == instance2) // 不合规，此处会对引用的相等进行检查，但这是本意吗？MyClass重写了Equals。
        {
            Console.WriteLine("Equal");
        }
    }
}
</pre>
<h2>合规的解决方案</h2>
<pre>
public interface IMyInterface
{
}

public class MyClass : IMyInterface
{
    public override bool Equals(object obj)
    {
        //……
    }
}

public class Program
{
    public static void Method(IMyInterface instance1, IMyInterface instance2)
    {
        if (object.Equals(instance1, instance2)) // object.Equals 会进行null值的检查然后调用基于Equals的实例，因此 so MyClass.Equals
        {
            Console.WriteLine("Equal");
        }
    }
}
</pre>
<h2>例外</h2>
<p>此规则不会报告 <code>System.Type</code> 实例的比较和在 <code>Equals</code> 重写方法内的比较。</p>
<p>当其中一个操作数为 <code>null</code> 或者强制转换为 <code>object</code> 时同样不会引发问题（因为在这些情况下我们想要保证的是引用相等，即使一些 <code>==</code> 已经重载（if some == overload is present））。</p>
<h2>请参阅</h2>
<ul>
  <li> <a href="http://cwe.mitre.org/data/definitions/595.html">MITRE, CWE-595</a> - Comparison of Object References Instead of Object Contents </li>
  <li> <a href="http://cwe.mitre.org/data/definitions/597.html">MITRE, CWE-597</a> - Use of Wrong Operator in String Comparison </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/wwD1AQ">CERT, EXP03-J.</a> - Do not use the equality operators when comparing values of
  boxed primitives </li>
  <li> <a href="https://www.securecoding.cert.org/confluence/x/8AEqAQ">CERT, EXP50-J.</a> - Do not confuse abstract object equality with reference
  equality </li>
</ul>

